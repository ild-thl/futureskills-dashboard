<div class="offeredit-form">
  <div *ngIf="isError; else showDetail" class="container">
    <div class="row">
      <div class="col-12">
        <fs-error-back-text [errorText]="errMessage"></fs-error-back-text>
      </div>
    </div>
  </div>

  <ng-template #showDetail>
    <div class="container">
      <!-- nav -->
      <div class="row mb-4">
        <div class="col-12" *ngIf="!createNewOffer; else new_Offer">
          <button
            type="button"
            class="btn btn-outline-primary mb-3"
            [routerLink]="[lnkOffers, offer?.id]"
          >
            Zur Detailseite
          </button>
        </div>

        <ng-template #new_Offer>
          <div class="col-12">
            <button type="button" class="btn btn-outline-primary mb-3" [routerLink]="lnkOffers">
              Zur Kursliste
            </button>
          </div>
        </ng-template>
      </div>
      <!-- nav -->

      <!-- form -->
      <form [formGroup]="offerEditForm">
        <div class="row">
          <div class="col-12 col-md-6">
            <div class="form-group">
              <label for="title">Titel</label>*
              <input
                class="form-control"
                formControlName="title"
                type="text"
                id="title"
                name="title"
                required
              />
            </div>

            <div class="form-group">
              <label for="hashtag">Hashtag</label>
              <input
                formControlName="hashtag"
                class="form-control"
                type="text"
                id="hashtag"
                name="hashtag"
              />
            </div>

            <div class="form-group">
              <label for="institution_id">Institution</label>*
              <select
                formControlName="institution_id"
                class="form-control"
                id="institution_id"
                name="institution_id"
                deactivated
              >
                <option value="1">FutureSkills</option>
                <option value="2">Microsoft Learn</option>
                <option value="3">OPEN vhb</option>
                <option value="4">KI-Campus</option>
                <option value="6">OpenCampus</option>
                <option value="7">CAU Kiel</option>
                <!--TODO Institutions-->
              </select>
            </div>

            <div class="form-group">
              <label for="url">Kurs-URL</label>
              <input formControlName="url" class="form-control" type="url" id="url" name="url" />
            </div>

            <div class="form-group">
              <label for="type">Format</label>*
              <select formControlName="type" class="form-control" id="type" name="type">
                <option value="online-course">Online Kurs</option>
                <option value="self-study-course">Selbstlernkurs</option>
                <option value="webinar">Webinar</option>
                <option value="presence-event">Präsenz Veranstaltung</option>
                <option value="presence-series">Präsenz Veranstaltungsreihe</option>
                <option value="course-package">Kurspaket</option>
                <option value="blended-learning">Blended Learning</option>
              </select>
            </div>

            <div class="form-group">
              <label for="subtitle">Kurzbeschreibung</label>
              <input
                formControlName="subtitle"
                class="form-control"
                type="text"
                id="subtitle"
                name="subtitle"
              />
            </div>

            <!-- Keywords -->
            <div class="mb-3">
              <label for="keywords">Keywords</label>
              <fs-multiselect formControlName="keywords"></fs-multiselect>
            </div>
          </div>

          <!-- -->

          <div class="col-12 col-md-6">
            <div class="form-group">
              <label for="sort_flag">Sortierung (je höher, desto weiter oben)</label>
              <input
                formControlName="sort_flag"
                class="form-control"
                type="number"
                id="sort_flag"
                name="sort_flag"
                value="0"
              />
            </div>

            <div class="form-group">
              <label for="image_path">Bild URL</label>
              <input
                formControlName="image_path"
                class="form-control"
                type="text"
                id="image_path"
                name="image_path"
              />
            </div>

            <div class="form-group">
              <fieldset>
                <legend>Programm</legend>
                <div class="form-group checkcontainer">
                  <div class="custom-control custom-checkbox custom-control-inline">
                    <input
                      formControlName="competence_classic"
                      type="checkbox"
                      class="custom-control-input"
                      id="competence_classic"
                      name="competence_classic"
                    />
                    <label class="custom-control-label" for="competence_classic">Classic</label>
                  </div>

                  <div class="custom-control custom-checkbox custom-control-inline">
                    <input
                      formControlName="competence_digital"
                      type="checkbox"
                      class="custom-control-input"
                      id="competence_digital"
                      name="competence_digital"
                    />
                    <label class="custom-control-label" for="competence_digital">Digital</label>
                  </div>
                  <div class="custom-control custom-checkbox custom-control-inline">
                    <input
                      formControlName="competence_tech"
                      type="checkbox"
                      class="custom-control-input"
                      id="competence_tech"
                      name="competence_tech"
                    />
                    <label class="custom-control-label" for="competence_tech">Tech</label>
                  </div>
                </div>
              </fieldset>
            </div>

            <div class="form-group">
              <label for="language">Sprache</label>*
              <select
                formControlName="language"
                class="form-control"
                id="language"
                name="language"
                value="de"
              >
                <option value="de" selected="selected">Deutsch</option>
                <option value="en">English</option>
              </select>
            </div>

            <div class="form-group">
              <label for="author">Autor/innen</label>
              <input
                formControlName="author"
                class="form-control"
                type="author"
                id="author"
                name="author"
              />
            </div>

            <div class="form-group">
              <label for="target_group">Zielgruppe</label>
              <input
                formControlName="target_group"
                class="form-control"
                type="target_group"
                id="target_group"
                name="target_group"
              />
            </div>

            <div class="form-group mt-5">
              <button
                class="btn btn-light"
                type="button"
                (click)="collapse.toggle()"
                [attr.aria-expanded]="!isCollapsed"
                aria-controls="collapseExample"
              >
                Weitere Felder anzeigen
                <span class="caret">
                  <fa-icon [icon]="['fas', 'angle-down']"></fa-icon>
                </span>
              </button>
            </div>
          </div>
        </div>

        <!-- weitere Felder -->
        <div #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsed" class="row">
          <div class="col-12 col-md-6">
            <!--
        <div class="mb-2">
          <label for="ects">ECTS</label>
          <input formControlName="ects" class="form-control" type="number" id="ects" name="ects" value="0" />
        </div>
        -->

            <div class="form-group">
              <label for="time_requirement">Arbeitsaufwand</label>
              <input
                formControlName="time_requirement"
                class="form-control"
                type="time_requirement"
                id="time_requirement"
                name="time_requirement"
              />
            </div>

            <div class="form-group">
              <label for="sponsor">Sponsor</label>
              <input
                formControlName="sponsor"
                class="form-control"
                type="sponsor"
                id="sponsor"
                name="sponsor"
              />
            </div>

            <div class="form-group">
              <label for="exam">Prüfung</label>
              <input
                formControlName="exam"
                class="form-control"
                type="exam"
                id="exam"
                name="exam"
              />
            </div>

            <div class="form-group">
              <label for="requirements">Voraussetzungen</label>
              <input
                formControlName="requirements"
                class="form-control"
                type="requirements"
                id="requirements"
                name="requirements"
              />
            </div>

            <div class="form-group">
              <label for="niveau">Niveau</label>
              <input
                formControlName="niveau"
                class="form-control"
                type="niveau"
                id="niveau"
                name="niveau"
              />
            </div>
          </div>
          <div class="col-12 col-md-6">
            <div class="form-group">
              <label for="executed_from">Ausführung ab</label>
              <input
                formControlName="executed_from"
                class="form-control"
                type="executed_from"
                id="executed_from"
                name="executed_from"
              />
            </div>

            <div class="form-group">
              <label for="executed_until">Ausführung bis</label>
              <input
                formControlName="executed_until"
                class="form-control"
                type="executed_until"
                id="executed_until"
                name="executed_until"
              />
            </div>

            <div class="form-group">
              <label for="listed_from">Listung ab</label>
              <input
                formControlName="listed_from"
                class="form-control"
                type="listed_from"
                id="listed_from"
                name="listed_from"
              />
            </div>

            <div class="form-group">
              <label for="listed_until">Listung bis</label>
              <input
                formControlName="listed_until"
                class="form-control"
                type="listed_until"
                id="listed_until"
                name="executed_until"
              />
            </div>
          </div>
        </div>

        <!-- Beschreibung -->
        <div class="mt-3">
          <div class="form-group">
            <label for="description">Beschreibung</label>
            <angular-editor
              formControlName="description"
              name="description"
              id="description"
              class="w-100"
              [config]="editorConfig"
            ></angular-editor>
          </div>
        </div>

        <!-- Kurs-Relation-->
        <div class="form-group">
          <fs-offer-relations-selection
            formControlArray="relatedOfferFormArray"
            (relatedOffersOutput)="updateRelatedOffers($event)"
            [offer]="offer"
            *ngIf="!isLoading"
            class="col-12 no-gutters"
          >
          </fs-offer-relations-selection>
        </div>

        <div class="form-group col-12 p-0">
          <button
            (click)="onSaveData(offerEditForm.value)"
            class="btn btn-primary mb-3"
            type="button"
            *ngIf="!createNewOffer"
          >
            Speichern
          </button>
          <button
            (click)="onSaveData(offerEditForm.value)"
            class="btn btn-primary mb-3"
            type="button"
            *ngIf="createNewOffer"
          >
            Anlegen
          </button>
        </div>
      </form>

      <p *ngFor="let alert of alerts">
        <ngb-alert [type]="alert.type" (closed)="closeAlert(alert)">{{ alert.message }}</ngb-alert>
      </p>
    </div>
  </ng-template>
</div>
